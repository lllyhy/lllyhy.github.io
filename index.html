<!DOCTYPE html>
<html>
<head>
  <title>Supabase 数据管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 引入 Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; color: #333; }
    .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #3b82f6; text-align: center; margin-bottom: 30px; }
    .button-group { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
    button { padding: 10px 15px; background-color: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.2s; }
    button:hover { background-color: #2563eb; }
    button:disabled { background-color: #9ca3af; cursor: not-allowed; }
    .data-container { border: 1px solid #e5e7eb; border-radius: 5px; padding: 15px; min-height: 100px; background-color: #f9fafb; }
    .loading { text-align: center; color: #6b7280; margin: 20px 0; }
    .error { color: #ef4444; background-color: #fee2e2; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
    .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .data-table th, .data-table td { padding: 10px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .data-table th { background-color: #f3f4f6; }
    .status { margin-top: 15px; padding: 10px; border-radius: 5px; text-align: center; }
    .success { background-color: #dcfce7; color: #166534; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Supabase 数据管理</h1>
    
    <div class="button-group">
      <button id="addBtn">添加测试数据</button>
      <button id="getBtn">查询数据</button>
    </div>
    
    <div id="errorContainer" class="error" style="display: none;"></div>
    
    <div id="statusContainer" class="status" style="display: none;"></div>
    
    <div class="data-container">
      <div id="loading" class="loading" style="display: none;">加载中...</div>
      <div id="dataDisplay"></div>
    </div>
  </div>

  <script>
    // 初始化Supabase客户端
    const supabaseUrl = 'https://qmvdqaoxlcewxzmkhggs.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtdmRxYW94bGNld3h6bWtoZ2dzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMDc5NzQsImV4cCI6MjA2ODU4Mzk3NH0.RfNFyAj1oATmU1dcDplVgT_szER-hj4cygF7ftb4xqk';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    
    // DOM元素
    const addBtn = document.getElementById('addBtn');
    const getBtn = document.getElementById('getBtn');
    const dataDisplay = document.getElementById('dataDisplay');
    const loading = document.getElementById('loading');
    const errorContainer = document.getElementById('errorContainer');
    const statusContainer = document.getElementById('statusContainer');
    
    // 显示加载状态
    function showLoading() {
      loading.style.display = 'block';
      dataDisplay.innerHTML = '';
      errorContainer.style.display = 'none';
      statusContainer.style.display = 'none';
    }
    
    // 隐藏加载状态
    function hideLoading() {
      loading.style.display = 'none';
    }
    
    // 显示错误
    function showError(message) {
      errorContainer.textContent = message;
      errorContainer.style.display = 'block';
    }
    
    // 显示状态消息
    function showStatus(message, isSuccess = true) {
      statusContainer.textContent = message;
      statusContainer.className = isSuccess ? 'status success' : 'status error';
      statusContainer.style.display = 'block';
    }
    
    // 添加数据
    async function addData() {
      showLoading();
      try {
        const { data, error } = await supabase
          .from('users')
          .insert([{ name: '张三', age: 25 }]);
        
        if (error) {
          showError(`插入失败：${error.message}`);
          console.error('插入失败：', error);
        } else {
          showStatus('数据插入成功！');
          console.log('插入成功：', data);
        }
      } catch (err) {
        showError(`操作异常：${err.message}`);
        console.error('操作异常：', err);
      } finally {
        hideLoading();
      }
    }
    
    // 查询数据
    async function getData() {
      showLoading();
      try {
        const { data, error } = await supabase
          .from('users')
          .select('*');
        
        if (error) {
          showError(`查询失败：${error.message}`);
          console.error('查询失败：', error);
        } else {
          renderData(data);
          showStatus(`查询成功，共 ${data.length} 条数据`);
          console.log('查询结果：', data);
        }
      } catch (err) {
        showError(`操作异常：${err.message}`);
        console.error('操作异常：', err);
      } finally {
        hideLoading();
      }
    }
    
    // 渲染数据到页面
    function renderData(data) {
      if (!data || data.length === 0) {
        dataDisplay.innerHTML = '<p>没有查询到数据</p>';
        return;
      }
      
      let html = '<table class="data-table">';
      html += '<thead><tr><th>ID</th><th>姓名</th><th>年龄</th></tr></thead>';
      html += '<tbody>';
      
      data.forEach(item => {
        html += `<tr>
          <td>${item.id || '-'}</td>
          <td>${item.name || '-'}</td>
          <td>${item.age || '-'}</td>
        </tr>`;
      });
      
      html += '</tbody></table>';
      dataDisplay.innerHTML = html;
    }
    
    // 事件监听
    addBtn.addEventListener('click', addData);
    getBtn.addEventListener('click', getData);
    
    // 初始加载时自动查询一次数据
    getData();
  </script>
</body>
</html>